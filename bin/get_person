#!/usr/bin/env ruby

$LOAD_PATH << File.expand_path('../../lib/', __FILE__)
#$LOAD_PATH << File.expand_path('../../ftl_mongo/lib/', __FILE__)
$LOAD_PATH << File.expand_path('../../ftl_chargen/lib/', __FILE__)

require 'optparse'

require 'ftl_mongo'
require 'character'
require 'presenter'

db_data = {'host':'localhost', 'port':27017, 'db':'people', 'coll': 'people'}
db_conn = MongoConn.new(db_data)

options = {}
parser = OptionParser.new do |opts|
  opts.on('-n name', '--name', 'Select a character by name') do |n|
    options[:name] = n
  end
end
parser.parse!

name = options[:name]

query = {'name': /#{name}/ }
db_conn.find(query).each do |d|
  p = Hash[d]
  person = Character.new(p)
  Presenter.show(person)
end
